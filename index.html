<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Currency & Crypto Converter</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">ðŸ’± Currency & Crypto Converter</h1>

    <!-- Converter Card -->
    <div class="bg-white shadow rounded-2xl p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">Currency Converter</h2>
      <div class="grid gap-4 md:grid-cols-3">
        <input id="amount" type="number" value="1" class="border rounded-lg p-2 w-full" />
        <select id="from" class="border rounded-lg p-2 w-full"></select>
        <select id="to" class="border rounded-lg p-2 w-full"></select>
      </div>
      <div class="flex gap-3 mt-4">
        <button id="convertBtn" class="px-4 py-2 rounded-xl bg-indigo-600 text-white shadow">Convert</button>
        <button id="swapBtn" class="px-4 py-2 rounded-xl bg-slate-200">Swap</button>
      </div>
      <div id="result" class="mt-4 text-lg font-medium"></div>
      <div id="rateInfo" class="text-sm text-slate-600"></div>
      <div class="mt-4 flex flex-wrap gap-2">
        <button class="quick-btn px-3 py-1 rounded-lg bg-slate-100" data-quick="GBP|USD">GBP â†’ USD</button>
        <button class="quick-btn px-3 py-1 rounded-lg bg-slate-100" data-quick="USD|EUR">USD â†’ EUR</button>
        <button class="quick-btn px-3 py-1 rounded-lg bg-slate-100" data-quick="EUR|GBP">EUR â†’ GBP</button>
      </div>
    </div>

    <!-- Crypto Card -->
    <div class="bg-white shadow rounded-2xl p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Crypto Prices</h2>
        <button id="refreshCrypto" class="text-sm px-3 py-1 rounded-lg bg-slate-100">Refresh</button>
      </div>
      <div id="cryptoGrid" class="grid gap-4 sm:grid-cols-2"></div>
    </div>

    <footer class="text-center text-sm text-slate-500 mt-6">
      <!-- Donation Button -->
      <div class="mb-4">
        <a 
          href="https://www.paypal.me/yourusername" 
          target="_blank" 
          class="inline-block px-6 py-2 rounded-xl bg-gradient-to-r from-indigo-600 to-blue-500 text-white font-semibold shadow hover:from-indigo-700 hover:to-blue-600 transition duration-200"
        >
          â˜• Support with a Donation
        </a>
      </div>
      <!-- Replace 'https://www.paypal.me/yourusername' with your actual donation link (e.g., PayPal, Ko-fi, Buy Me a Coffee) -->
      Â© <span id="year"></span> Currency Converter
    </footer>
  </div>

  <script>
    const fxEndpoint = 'https://open.er-api.com/v6/latest'; // free FX API
    const cryptoEndpoint = 'https://api.coingecko.com/api/v3/simple/price';

    const amountEl = document.getElementById('amount');
    const fromEl = document.getElementById('from');
    const toEl = document.getElementById('to');
    const resultEl = document.getElementById('result');
    const rateInfoEl = document.getElementById('rateInfo');
    const swapBtn = document.getElementById('swapBtn');
    const convertBtn = document.getElementById('convertBtn');
    const yearEl = document.getElementById('year');

    const popularFiat = ['GBP','USD','EUR','JPY','CHF','AUD','CAD'];
    yearEl.textContent = new Date().getFullYear();

    function loadPrefs() {
      try { return JSON.parse(localStorage.getItem('prefs') || '{}'); }
      catch { return {}; }
    }
    function savePrefs(prefs) {
      localStorage.setItem('prefs', JSON.stringify(prefs));
    }

    // ---- FX fetching ----
    async function fetchFx(base='GBP') {
      const url = `${fxEndpoint}/${encodeURIComponent(base)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('FX fetch failed');
      const data = await res.json();
      if (data.result !== 'success') throw new Error('FX API error');
      return { 
        rates: data.rates, 
        date: new Date(data.time_last_update_utc) 
      };
    }

    async function initFx() {
      const prefs = loadPrefs();
      const base = prefs.base || 'GBP';
      try {
        const data = await fetchFx(base);
        const codes = Object.keys(data.rates);
        const list = Array.from(new Set([...popularFiat, ...codes])).sort();

        fromEl.innerHTML = list.map(c => `<option ${c===base? 'selected':''}>${c}</option>`).join('');
        const defaultTo = prefs.to || (base === 'GBP' ? 'USD' : 'GBP');
        toEl.innerHTML = list.map(c => `<option ${c===defaultTo? 'selected':''}>${c}</option>`).join('');

        convert(data);
      } catch (err) {
        resultEl.textContent = 'Could not load FX rates. Try again later.';
        console.error(err);
      }
    }

    function formatMoney(val, code) {
      try {
        return new Intl.NumberFormat(undefined, { style: 'currency', currency: code }).format(val);
      } catch {
        return `${val.toFixed(2)} ${code}`;
      }
    }

    function convert(preloaded=null) {
      const base = fromEl.value;
      const target = toEl.value;
      const amt = parseFloat(amountEl.value || '0');
      if (!amt || amt < 0) { resultEl.textContent = 'Enter a positive amount'; return; }

      const doCalc = (data) => {
        const rate = data.rates[target];
        if (!rate) { resultEl.textContent = 'Unsupported pair'; return; }
        const out = amt * rate;
        resultEl.textContent = `${formatMoney(amt, base)} = ${formatMoney(out, target)}`;
        rateInfoEl.textContent = `Rate: 1 ${base} = ${rate.toFixed(6)} ${target} Â· ${data.date.toDateString()}`;
        savePrefs({ base, to: target });
      };

      if (preloaded) return doCalc(preloaded);
      fetchFx(base).then(doCalc).catch(err => {
        console.error(err);
        resultEl.textContent = 'Conversion failed.';
      });
    }

    swapBtn.addEventListener('click', () => {
      const a = fromEl.value; const b = toEl.value;
      fromEl.value = b; toEl.value = a;
      convert();
    });
    convertBtn.addEventListener('click', () => convert());

    document.querySelectorAll('.quick-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const [a,b] = btn.dataset.quick.split('|');
        fromEl.value = a; toEl.value = b; convert();
      });
    });

    // ---- Crypto section ----
    const cryptoGrid = document.getElementById('cryptoGrid');
    const refreshCrypto = document.getElementById('refreshCrypto');

    async function fetchCrypto() {
      const ids = ['bitcoin','ethereum','pepe'];
      const vs = ['gbp','usd','eur'];
      const url = `${cryptoEndpoint}?ids=${ids.join(',')}&vs_currencies=${vs.join(',')}&include_24hr_change=true`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Crypto fetch failed');
      return res.json();
    }

    function chip(change) {
      const sign = change >= 0 ? '+' : '';
      const cls = change >= 0 ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : 'bg-rose-50 text-rose-700 border-rose-200';
      return `<span class="text-xs px-2 py-1 rounded-full border ${cls}">${sign}${change.toFixed(2)}% 24h</span>`;
    }

    function cryptoCard(symbol, data) {
      const name = symbol.toUpperCase();
      const gbp = data.gbp;
      const usd = data.usd;
      const chg = data.gbp_24h_change ?? 0;
      return `
        <div class="rounded-2xl border border-slate-200 p-4 shadow bg-white">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">${name}</h3>
            ${chip(chg)}
          </div>
          <p class="text-2xl font-bold mt-2">${formatMoney(gbp, 'GBP')}</p>
          <p class="text-sm text-slate-600">${formatMoney(usd, 'USD')}</p>
          <div class="mt-3 text-xs text-slate-500">Data: CoinGecko</div>
        </div>`;
    }

    async function renderCrypto() {
      cryptoGrid.innerHTML = '<div class="col-span-full text-slate-600">Loadingâ€¦</div>';
      try {
        const data = await fetchCrypto();
        cryptoGrid.innerHTML = [
          cryptoCard('btc', data.bitcoin),
          cryptoCard('eth', data.ethereum),
          cryptoCard('pepe', data.pepe)
        ].join('');
      } catch (err) {
        console.error(err);
        cryptoGrid.innerHTML = '<div class="col-span-full text-rose-600">Could not load crypto prices.</div>';
      }
    }

    refreshCrypto.addEventListener('click', renderCrypto);

    // Init
    initFx();
    renderCrypto();
  </script>
</body>
</html>
